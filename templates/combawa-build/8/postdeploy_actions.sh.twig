#!/bin/bash
# Action to run after the main and shared deployment actions.
# It can be useful to enable specific modules for instance.
# Available variables are defined in settings.sh.

# Return error codes if they happen.
set -e

PROFILE={{ machine_name }}
THEME={{ machine_name }}_theme

case $COMBAWA_ENV in
  dev)
    # Build theme assets.
    (
      cd $WEBROOT/themes/custom/$THEME
      npm install
      npm run build-dev
    )

    # Clear assets cache to ensure previously generated files are used.
    $DRUSH cc css-js

    # Rebuild search indexes.
#    $DRUSH sapi-r
#    $DRUSH sapi-i

    #Â Connect.
    $DRUSH uli
    ;;
  recette|preprod)
    # Build theme assets.
    (
      cd $WEBROOT/themes/custom/$THEME
      npm install
      npm run build
    )

    # Clear assets cache to ensure previously generated files are used.
    $DRUSH cc css-js

    # Rebuild search indexes.
#    $DRUSH sapi-r
#    $DRUSH sapi-i
    ;;
  prod)
    # Build theme assets.
    (
      cd $WEBROOT/themes/custom/$THEME
      npm install
      npm run build
    )

    # Clear assets cache to ensure previously generated files are used.
    $DRUSH cc css-js
    ;;
  *)
    notify_error "Unknown environment: $COMBAWA_ENV. Please check your name."
esac

