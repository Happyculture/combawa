#!/bin/bash
# Action to run after the main and shared deployment actions.
# It can be useful to enable specific modules for instance.
# Available variables are defined in settings.sh.

# Return error codes if they happen.
set -e

PROFILE={{ machine_name }}
THEME={{ machine_name }}_theme

case $COMBAWA_ENV in
  dev)
    # Compile CSS for development.
    (
      cd $WEBROOT/themes/custom/$THEME
      if [ "$COMBAWA_OFFLINE" == "0" ] ; then $NPM install; fi
      $NPM run build-dev
    )

    # Rebuild search indexes.
#    $DRUSH sapi-r
#    $DRUSH sapi-i

    #Â Connect.
    $DRUSH uli
    ;;
  recette|preprod)
    # Compile CSS for production.
    (
      cd $WEBROOT/themes/custom/$THEME
      if [ "$COMBAWA_OFFLINE" == "0" ] ; then $NPM install; fi
      $NPM run build
    )

    # Rebuild search indexes.
#    $DRUSH sapi-r
#    $DRUSH sapi-i
    ;;
  prod)
    # Compile CSS for production.
    (
      cd $WEBROOT/themes/custom/$THEME
      if [ "$COMBAWA_OFFLINE" == "0" ] ; then $NPM install; fi
      $NPM run build
    )
    ;;
  *)
    echo "Unknown environment: $COMBAWA_ENV. Please check your name."
    exit 1;
esac

